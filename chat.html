<!DOCTYPE html>
<html lang="en-US">
<head>
    <link rel="stylesheet" href="chat-stylesheet.css">
    <meta name="google-signin-client_id" content="346925839515-g5rho0muuob69h91ivpeh6nrvho870ii.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://apis.google.com/js/api:client.js"></script>

    <script src="https://alloy-backend.herokuapp.com/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="sockets.js"></script>
    <script type="text/javascript" src="user_interface.js"></script>
    <script type="text/javascript" src="cookies.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="theme-color" content="#ffffff">
    
    <meta charset="utf-8"/>
    <title>Alloy</title>

    <script>
        try {
            gapi.load('auth2', function() {
                gapi.auth2.init({
                    client_id: '346925839515-g5rho0muuob69h91ivpeh6nrvho870ii.apps.googleusercontent.com'
                }).then(function () {
                    auth2 = gapi.auth2.getAuthInstance();
                    let profile = auth2.currentUser.get().getBasicProfile()
                    googleID = profile.getId();
                    googleName = profile.getName();
                    googlePhoto = profile.getImageUrl();
                    name = googleName;
                    photoLink = googlePhoto;
                    if (!auth2.isSignedIn.get() || getSessionToken() == null || getUpdateToken() == null) {
                        document.location.href = `/login.html`;
                    }
                    else {
                        openCourses();    
                    }
                });
            });
        } 
        catch (err) {
            document.location.href = `/login.html`;
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(() => {
                console.log('User signed out.');
                document.location.href = "/login.html"
            });
        }
        window.onbeforeunload = closeMessages;
    </script>
    
</head>

<body>
    <div class="sidebar">
        <img src="logo-shadow.svg" class="logo-small">
        <button type="button" id="browse">Browse</button>
        <button type="button" onclick="openCourses()" id="courses">My courses</button>
        <button type="button" onclick="openAssignments()" id="groups">My groups</button>
        <button type="button" id="profile">My profile</button>
        <button type="button" id="logout">Sign out</button>
        <button type="button" onclick="toggleIncognito(this)" id="incognito-button"></button>
    </div>
    <div class="sidebar-extension compact"></div>
    <div class="sidebar-extension second compact"></div>
    <div id="modal">
        <div id="modal-content">
            <h1 id="modal-title">Search for a class:</h1><button class="close" onclick="hideModal()">&times;</button>
            <div style="display: inline-block"><div id="modal-info">
                <input id="modal-field" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                onkeyup="" placeholder="Enter a name..." maxlength="50">
                <button id="confirm-modal" onclick="submitModal()">
            </div></div>
        </div>
        <div id="search-results"></div>
        
    </div>
    

    <div id="main">
        <div id="group-header"><span id="class-name"></span><span id="group-name"></span></div>
        <div id="message-holder"></div>
        <div id="message-area">
            <form name="message-sender" onsubmit="return sendMessage()">
                <input id="message-field" placeholder="Type a message..." autocomplete="off">
                <input id="send" type="submit" value="Send">
            </form>
        </div>
        
    </div>

    <script>
        document.getElementById("browse").addEventListener("click", () => {
            document.location.href = "/browse.html"
        });
        document.getElementById("courses").addEventListener("click", openCourses);
        document.getElementById("groups").addEventListener("click", openAssignments);
        document.getElementById("profile").addEventListener("click", () => {
            document.location.href = "/profile.html"
        });
        document.getElementById("logout").addEventListener("click", signOut);
        document.getElementById("modal-field").addEventListener("keyup", () => {
            if (document.getElementById("confirm-modal").className == "search") {
                filter();
            }
        })
    </script>
</body>
</html>